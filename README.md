# VPS ç›‘æ§ç³»ç»Ÿ

è½»é‡çº§ VPS ç›‘æ§ç³»ç»Ÿï¼Œå®æ—¶ç›‘æ§ç³»ç»Ÿèµ„æºå’Œ Docker å®¹å™¨çŠ¶æ€ï¼Œé€šè¿‡ä¼ä¸šå¾®ä¿¡æœºå™¨äººå‘é€å‘Šè­¦é€šçŸ¥ã€‚

## åŠŸèƒ½ç‰¹æ€§

- **ç³»ç»Ÿç›‘æ§**: CPUã€å†…å­˜ã€ç£ç›˜ã€Swap ä½¿ç”¨ç‡ç›‘æ§
- **ç½‘ç»œç›‘æ§**: ç½‘ç»œæµé‡ã€è¿æ¥æ•°ç›‘æ§
- **Docker ç›‘æ§**: å®¹å™¨è¿è¡ŒçŠ¶æ€ã€å¥åº·æ£€æŸ¥ç›‘æ§
- **å‘Šè­¦é€šçŸ¥**: ä¼ä¸šå¾®ä¿¡æœºå™¨äººå‘Šè­¦ï¼Œæ”¯æŒå‘Šè­¦å†·å´å’Œæ¢å¤é€šçŸ¥
- **å®šæ—¶æŠ¥å‘Š**: åŸºäº Cron è¡¨è¾¾å¼çš„å®šæ—¶çŠ¶æ€æŠ¥å‘Š
- **systemd æœåŠ¡**: å¼€æœºè‡ªå¯ï¼Œè‡ªåŠ¨é‡å¯

## å¿«é€Ÿå¼€å§‹

### ä¸€é”®å®‰è£…ï¼ˆæ¨èï¼‰

```bash
curl -fsSL https://raw.githubusercontent.com/venomwise/vps-monitor/main/install.sh | sudo bash
```

ä¸€é”®å®‰è£…ä¼šè‡ªåŠ¨å®Œæˆï¼š
- ä¸‹è½½ç¨‹åºæ–‡ä»¶åˆ° `/opt/vps-monitor/`
- å®‰è£… Python ä¾èµ–
- é…ç½® systemd æœåŠ¡

å®‰è£…å®Œæˆåï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo vim /opt/vps-monitor/config.yaml  # å¡«å…¥ä¼ä¸šå¾®ä¿¡ Webhook URL
sudo systemctl start vps-monitor
```

**æ›´æ–°ç¨‹åº**ï¼šå†æ¬¡è¿è¡Œä¸€é”®å®‰è£…å‘½ä»¤å³å¯ï¼Œé…ç½®æ–‡ä»¶ä¼šä¿ç•™ã€‚

---

### æ‰‹åŠ¨å®‰è£…

#### 1. å®‰è£…ä¾èµ–

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3 python3-pip curl

# å®‰è£… Python ä¾èµ–
pip3 install -r requirements.txt
```

#### 2. é…ç½®

ç¼–è¾‘ `config.yaml` æ–‡ä»¶ï¼š

```yaml
# ä¼ä¸šå¾®ä¿¡æœºå™¨äººé…ç½®ï¼ˆå¿…å¡«ï¼‰
wechat:
  webhook_url: "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY"

# Docker å®¹å™¨ç›‘æ§ï¼ˆæŒ‰éœ€é…ç½®ï¼‰
docker:
  enabled: true
  containers:
    - name: "nginx"
      check_health: true
    - name: "mysql"
      check_health: true
```

#### 3. å®‰è£…æœåŠ¡

```bash
sudo ./install.sh
```

#### 4. å¯åŠ¨æœåŠ¡

```bash
sudo systemctl start vps-monitor
sudo systemctl status vps-monitor
```

## é…ç½®è¯´æ˜

### åŸºç¡€é…ç½®

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `general.hostname` | è‡ªåŠ¨è·å– | ä¸»æœºåï¼Œç•™ç©ºè‡ªåŠ¨è·å– |
| `general.check_interval` | 900 | æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ |
| `general.alert_cooldown` | 300 | å‘Šè­¦å†·å´æ—¶é—´ï¼ˆç§’ï¼‰ |
| `general.send_recovery` | true | æ˜¯å¦å‘é€æ¢å¤é€šçŸ¥ |
| `general.log_level` | INFO | æ—¥å¿—çº§åˆ« |

### ç›‘æ§é˜ˆå€¼

| æŒ‡æ ‡ | é»˜è®¤é˜ˆå€¼ | è¯´æ˜ |
|------|----------|------|
| å†…å­˜ä½¿ç”¨ç‡ | 80% | è¶…è¿‡é˜ˆå€¼è§¦å‘å‘Šè­¦ |
| ç£ç›˜ä½¿ç”¨ç‡ | 80% | è¶…è¿‡é˜ˆå€¼è§¦å‘å‘Šè­¦ |
| CPU ä½¿ç”¨ç‡ | 80% | è¶…è¿‡é˜ˆå€¼è§¦å‘å‘Šè­¦ |
| Swap ä½¿ç”¨ç‡ | 80% | è¶…è¿‡é˜ˆå€¼è§¦å‘å‘Šè­¦ |
| ç½‘ç»œæµé‡ | 100 Mbps | è¶…è¿‡é˜ˆå€¼è§¦å‘å‘Šè­¦ |
| è¿æ¥æ•° | 1000 | è¶…è¿‡é˜ˆå€¼è§¦å‘å‘Šè­¦ |

### å®šæ—¶æŠ¥å‘Š

```yaml
scheduled_report:
  enabled: true
  cron: "0 9 * * *"  # æ¯å¤© 9:00
```

å¸¸ç”¨ Cron è¡¨è¾¾å¼ï¼š
- `0 9 * * *` - æ¯å¤© 9:00
- `0 9,18 * * *` - æ¯å¤© 9:00 å’Œ 18:00
- `0 */6 * * *` - æ¯ 6 å°æ—¶
- `0 9 * * 1` - æ¯å‘¨ä¸€ 9:00

## å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl start vps-monitor

# åœæ­¢æœåŠ¡
sudo systemctl stop vps-monitor

# é‡å¯æœåŠ¡
sudo systemctl restart vps-monitor

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status vps-monitor

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u vps-monitor -f

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /opt/vps-monitor/logs/monitor.log
```

## å¸è½½

```bash
sudo ./uninstall.sh
```

## æ–‡ä»¶ç»“æ„

```
/opt/vps-monitor/
â”œâ”€â”€ monitor.py          # ä¸»ç¨‹åº
â”œâ”€â”€ config.yaml         # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt    # Python ä¾èµ–
â”œâ”€â”€ alert_state.json    # å‘Šè­¦çŠ¶æ€ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â””â”€â”€ logs/
    â””â”€â”€ monitor.log     # æ—¥å¿—æ–‡ä»¶
```

## æ¶ˆæ¯æ ¼å¼ç¤ºä¾‹

### å‘Šè­¦æ¶ˆæ¯
```
âš ï¸ VPS å‘Šè­¦ [hostname]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š å†…å­˜ä½¿ç”¨ç‡: 85.2% (é˜ˆå€¼: 80%)
â° æ—¶é—´: 2026-02-04 15:30:00
```

### æ¢å¤æ¶ˆæ¯
```
âœ… VPS æ¢å¤ [hostname]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š å†…å­˜ä½¿ç”¨ç‡: 72.1% (å·²æ¢å¤æ­£å¸¸)
â° æ—¶é—´: 2026-02-04 15:45:00
```

### å®šæ—¶çŠ¶æ€æŠ¥å‘Š
```
ğŸ“Š VPS çŠ¶æ€æŠ¥å‘Š [hostname]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ–¥ï¸ ç³»ç»ŸçŠ¶æ€
  â€¢ CPU: 23.5%
  â€¢ å†…å­˜: 65.2% (2.1GB / 3.2GB)
  â€¢ Swap: 12.0%
  â€¢ ç£ç›˜(/): 45.8% (18.3GB / 40GB)

ğŸŒ ç½‘ç»œçŠ¶æ€
  â€¢ å…¥ç«™: 2.3 Mbps
  â€¢ å‡ºç«™: 1.1 Mbps
  â€¢ è¿æ¥æ•°: 156

ğŸ³ Docker å®¹å™¨
  â€¢ nginx: âœ… running (healthy)
  â€¢ mysql: âœ… running (healthy)

â° æŠ¥å‘Šæ—¶é—´: 2026-02-04 09:00:00
```

## å¸¸è§é—®é¢˜

### 1. Docker ç›‘æ§ä¸å¯ç”¨

ç¡®ä¿ï¼š
- Docker æœåŠ¡å·²å¯åŠ¨
- ç›‘æ§ç¨‹åºæœ‰æƒé™è®¿é—® Docker socket
- å·²å®‰è£… docker Python åº“

### 2. ç½‘ç»œè¿æ¥æ•°è·å–å¤±è´¥

è·å–ç½‘ç»œè¿æ¥æ•°éœ€è¦ root æƒé™ï¼Œç¡®ä¿æœåŠ¡ä»¥ root ç”¨æˆ·è¿è¡Œã€‚

### 3. ä¼ä¸šå¾®ä¿¡é€šçŸ¥å‘é€å¤±è´¥

æ£€æŸ¥ï¼š
- Webhook URL æ˜¯å¦æ­£ç¡®
- æœåŠ¡å™¨æ˜¯å¦èƒ½è®¿é—®ä¼ä¸šå¾®ä¿¡ API
- æœºå™¨äººæ˜¯å¦è¢«ç¦ç”¨

## License

MIT
